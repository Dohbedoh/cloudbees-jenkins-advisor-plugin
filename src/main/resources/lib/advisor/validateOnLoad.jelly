<?jelly escape-by-default='true'?>
<j:jelly xmlns:j="jelly:core" xmlns:d="jelly:define" xmlns:st="jelly:stapler">
  <st:documentation>
    Check if Jenkins Health Advisor by CloudBees is correctly configured and the server is available.
    <st:attribute name="email" use="required">
      A valid email must be configured.
    </st:attribute>
  </st:documentation>

  <style type="text/css">
    .alert-success {
      color: #155724;
      background-color: #d4edda;
      border-color: #c3e6cb;
    }
  </style>

  <div>
    <j:if test="${email!=null}">
      <j:set var="validationStatus" value="${app.getDescriptorByName('com.cloudbees.jenkins.plugins.advisor.AdvisorGlobalConfiguration').connectionTest(email)}"/>
        <j:if test="${validationStatus.contains('service-operational')}">
          <div class="alert alert-success" role="alert">
            <strong>Jenkins Healthy Advisor by CloudBees has been successfully connected.</strong>
          </div>
        </j:if>
        <j:if test="${validationStatus.contains('tos-not-accepted')}">
          <div class="alert alert-warning" role="alert">
            <strong>Terms and Conditions not accepted.</strong>
            <p>To use Jenkins Health Advisor, please agree to <a href='https://www.cloudbees.com/jenkins/cloudbees-jenkins-advisor/terms-of-service'>our Terms and Conditions</a>.</p>
          </div>
        </j:if>
        <j:if test="${validationStatus.contains('xception')}">
          <div class="alert alert-warning" role="alert">
            <strong>Connection failure to Jenkins Health Advisor by CloudBees.</strong>
            <p>Check Advisor Server status at <a href="https://www.cloudbeesstatus.com/">cloudbeesstatus.com</a>.</p>
            <p>${validationStatus}</p>
          </div>
        </j:if>
    </j:if>
  </div>
</j:jelly>
